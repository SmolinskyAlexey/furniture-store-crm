// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µlet ordersWizard, catalogWizard, shiftsWizard, refundsWizard, clientsWizard, suppliersWizard, supplierRequestsWizard, writeOffsWizard, invoicesWizard, stockTransfersWizard, overheadExpenses;// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—èwindow.addEventListener('DOMContentLoaded', () => {    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–∞—Å—Ç–µ—Ä–∞ –∑–∞–∫–∞–∑–æ–≤    ordersWizard = new OrdersWizard();    catalogWizard = new CatalogWizard();    shiftsWizard = new ShiftsWizard();    refundsWizard = new RefundsWizard();    clientsWizard = new ClientsWizard();    suppliersWizard = new SuppliersWizard();    supplierRequestsWizard = new SupplierRequestsWizard();    writeOffsWizard = new WriteOffsWizard();    invoicesWizard =      new InvoicesWizard();    stockTransfersWizard =      new StockTransfersWizard();    overheadExpenses = new OverheadExpenses();    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏    initializeNavigation();});// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–ºfunction initializeNavigation() {    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é    document.querySelectorAll('.menu-item').forEach(item => {        item.addEventListener('click', (e) => {            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤            document.querySelectorAll('.menu-item').forEach(mi => mi.classList.remove('active'));            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ç–µ–∫—É—â–µ–º—É            e.currentTarget.classList.add('active');        });    });}// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—éfunction updateActiveMenuItem(functionName) {    document.querySelectorAll('.menu-item').forEach(item => {        item.classList.remove('active');        if (item.getAttribute('onclick')?.includes(functionName)) {            item.classList.add('active');        }    });}// –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏window.showHome = () => {    document.getElementById('pageTitle').textContent = '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞';    updateActiveMenuItem('showHome');};window.showOrders = () => {    document.getElementById('pageTitle').textContent = '–ú–æ–∏ –∑–∞–∫–∞–∑—ã';    updateActiveMenuItem('showOrders');};window.showCatalog = () => {    document.getElementById('pageTitle').textContent = 'Catalog';    updateActiveMenuItem('showCatalog');};function getShiftControlModal(shift) {    const isOpen = shift?.status === 'open';    return `        <div class="modal">            <div class="modal-content shift-modal">                <div class="modal-header">                    <h3 class="modal-title">${isOpen ? '–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É' : '–û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É'}</h3>                    <button class="modal-close" onclick="closeShiftModal()">                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">                            <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>                        </svg>                    </button>                </div>                <div class="modal-body">                    <p>                        ${isOpen                            ? `–°–º–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ <strong>${shift.openedAt}</strong><br>–ö–∞—Å—Å–∞: <strong>${shift.cash.toLocaleString()} –≥—Ä–Ω</strong>`                            : '–£–∫–∞–∂–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –≤ –∫–∞—Å—Å–µ:'}                    </p>                    ${                        !isOpen                        ? `                            <div class="form-group">                                <label class="form-label">–°—É–º–º–∞ –Ω–∞ –Ω–∞—á–∞–ª–æ —Å–º–µ–Ω—ã</label>                                <input type="number" id="shiftCashInput" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5000">                            </div>                        `                        : `                            <p>–£–∫–∞–∂–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –≤ –∫–∞—Å—Å–µ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</p>                            <div class="form-group">                                <label class="form-label">–û—Å—Ç–∞—Ç–æ–∫ –≤ –∫–∞—Å—Å–µ</label>                                <input type="number" class="form-control" id="shiftFinalCash" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É">                            </div>                            <div class="form-group">                                <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>                                <textarea class="form-control" id="shiftEndComment" rows="3" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è, –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ..."></textarea>                            </div>                        `                    }                </div>                <div class="modal-footer">                    <button class="btn btn-secondary" onclick="closeShiftModal()">–û—Ç–º–µ–Ω–∞</button>                    <button class="btn btn-primary" onclick="${isOpen ? 'closeShift()' : 'openShift()'}">                        ${isOpen ? '–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É' : '–û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É'}                    </button>                </div>            </div>        </div>    `;}function openShift() {    const cash = parseFloat(document.getElementById('shiftCashInput').value || 0);    if (isNaN(cash) || cash < 0) {        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');        return;    }    const comment = '';//–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤–∑—è—Ç—å –∏–∑ –ø–æ–ª—è, —Å–µ–π—á–∞—Å –ø–æ–ª—è –Ω–µ—Ç, –ø–æ—ç—Ç–æ–º—É –Ω–µ –ø—Ä–æ—Å—Ç–∞–≤–∏–ª    // const warehouse_id = 1;//—Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞,  –≤–æ–∑–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –≤–æ–æ–±—â–µ –∏–∑ –±—ç–∫–∞, —Ç–æ—á–∫–∞ –∫—É–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω —é–∑–µ—Ä    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: new URLSearchParams({            action: 'add',            start_cash: cash,            start_comment: comment,        })    })    .then(r => r.json())    .then(json => {        if (json.ok) {            console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã —Å –∫–∞—Å—Å–æ–π: ' + cash);            // this.showSuccess("–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç–∞!");            window.location.reload();//–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã        } else {            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã');        }    })    .catch(console.error);    closeShiftModal();}function closeShift() {    const finalCash = parseFloat(document.getElementById('shiftFinalCash') !== null ? document.getElementById('shiftFinalCash').value : 0 || 0);    const comment = document.getElementById('shiftEndComment') !== null ? document.getElementById('shiftEndComment').value.trim() : "";    if (isNaN(finalCash) || finalCash < 0) {        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –æ—Å—Ç–∞—Ç–∫–∞');        return;    }    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: new URLSearchParams({            action: 'close',            end_cash: finalCash,            end_comment: comment,        })    })    .then(r => r.json())    .then(json => {        if (json.ok) {            console.log(`–°–º–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∞. –û—Å—Ç–∞—Ç–æ–∫: ${finalCash} –≥—Ä–Ω. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}`);            // console.log('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞');        } else {            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã');        }    })    .catch(console.error);    closeShiftModal();}window.showShift = () => {	document.getElementById('pageTitle').textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π';    updateActiveMenuItem('showShift');    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: new URLSearchParams({            action: 'get'        })    })    .then(r => r.json())    .then(json => {        if (json.ok) {            // console.log('–ö–∞—Å—Å–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞');            document.querySelector('#modalContainer').innerHTML = getShiftControlModal(json.shift);            document.querySelector('#modalContainer').style.display = 'block';        } else {            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–º–µ–Ω—ã');        }    })    .catch(console.error);};function closeShiftModal() {    document.querySelector('#modalContainer').innerHTML = '';	document.querySelector('#modalContainer').style.display = 'none';}function getCashOperationModal(type) {    const isAdd = type === 'add';    const title = isAdd ? '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∫–∞—Å—Å—É' : '–í—ã–¥–∞—á–∞ –∏–∑ –∫–∞—Å—Å—ã';    return `        <div class="modal">            <div class="modal-content shift-modal">                <div class="modal-header">                    <h3 class="modal-title">${title}</h3>                    <button class="modal-close" onclick="closeShiftModal()">                      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>                    </svg>                    </button>                </div>                <div class="modal-body">                    <div class="form-group">                        <label class="form-label">–°—É–º–º–∞</label>                        <input type="number" class="form-control" id="cashAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">                    </div>                    <div class="form-group">                        <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>                        <textarea class="form-control" id="cashComment" rows="3" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–ª–∏ –≤—ã–¥–∞—á–∏..."></textarea>                    </div>                </div>                <div class="modal-footer">                    <button class="btn btn-secondary" onclick="closeShiftModal()">–û—Ç–º–µ–Ω–∞</button>                    <button class="btn btn-primary" onclick="submitCashOperation('${type}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>                </div>            </div>        </div>    `;}function addCash() {    document.querySelector('#modalContainer').innerHTML = getCashOperationModal('add');    document.querySelector('#modalContainer').style.display = 'block';}function removeCash() {    document.querySelector('#modalContainer').innerHTML = getCashOperationModal('remove');    document.querySelector('#modalContainer').style.display = 'block';}function submitCashOperation(type) {    const amount = parseFloat(document.getElementById('cashAmount').value || 0);    const comment = document.getElementById('cashComment').value.trim();    if (isNaN(amount) || amount <= 0) {        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');        return;    }    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: new URLSearchParams({            action: 'add_cash_movement',//–¥–æ–±–∞–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤            amount: amount,            direction: type === 'add' ? "cash_in" : "cash_out",            comment: comment,        })    })    .then(r => r.json())    .then(json => {        if (json.ok) {            console.log(`–û–ø–µ—Ä–∞—Ü–∏—è ${type === 'add' ? '–≤–Ω–µ—Å–µ–Ω–∏—è' : '–≤—ã–¥–∞—á–∏'}: ${amount} –≥—Ä–Ω, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}`);            // window.location.reload();//–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã            // this.showSuccess("–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–Ω–µ—Å–µ–Ω–∞ –≤ –±–∞–∑—É");        } else {            console.warn('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞—Å—Å–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏');        }    })    .catch(console.error);    closeShiftModal();}// Universal Modallet currentModalType;				window.generateUniversalPDF = async (objectType, objectId) => {    	try {        const formData = new FormData();        formData.append('action', "generate_pdf");        formData.append('id', objectId);                const response = await fetch('/ajax/' + objectType + '/', {            method: 'POST',            body: formData        });		        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞        const contentType = response.headers.get('content-type');        if (contentType && contentType.includes('application/json')) {            // –ï—Å–ª–∏ JSON - –∑–Ω–∞—á–∏—Ç –æ—à–∏–±–∫–∞            const errorData = await response.json();            throw new Error(errorData.message || '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF');        }                // –ü–æ–ª—É—á–∞–µ–º PDF –∫–∞–∫ blob        const pdfBlob = await response.blob();                // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è blob        const pdfUrl = URL.createObjectURL(pdfBlob);                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ        const pdfWindow = window.open(pdfUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');        if (!pdfWindow) {            // Fallback –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ –ø–æ–ø–∞–ø–æ–≤            const link = document.createElement('a');            link.href = pdfUrl;            link.download = `${objectType}_${objectId}.pdf`;            link.click();        }                // –û—á–∏—â–∞–µ–º URL —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è        setTimeout(() => {            URL.revokeObjectURL(pdfUrl);        }, 10000);            } catch (error) {        console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF:', error);        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF: ' + error.message);    }	};window.showUniversalModal = async (objectType, objectId, orderId = null) => {    // jQuery('#modalEditTop .modal-content').addClass('loader'); // TODO –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –ª–æ–∞–¥–µ—Ä    console.log(objectType, objectId, "!!!!!! SHOW", orderId);    currentModalType = objectType;    const formData = new FormData();    formData.append('action', "load_card");    formData.append('id', objectId);    // id –∑–∞–∫–∞–∑–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞    if (orderId !== null) {        formData.append('order_id', orderId);    }    const response = await fetch('/ajax/' + objectType + '/', {        method: 'POST',        body: formData    });    if (!response.ok) {        throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞');    }    // if (res == 'error') {    //     showNotification('–û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'error');    // }    // else if (res == 'empty') {    //     showNotification('–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'warning')    // }    const popupHtml = await response.text();    document.querySelector('#modalContainer').innerHTML = popupHtml;    document.querySelector('#modalContainer').style.display = 'block';    if(objectType === "orders" || objectType === "supplier_requests"){        attachListenersForOrderModal();        selectedProducts = [];        const productsTable = document.querySelector(".products-table");        const productRows = productsTable.querySelectorAll("tbody tr");        productRows.forEach(row => {             // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞            const productCard = row.querySelector(".product-card");                        if (productCard) {                // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ                const id = productCard.dataset.id;                const name = productCard.querySelector(".product-name").textContent.trim();                const priceText = productCard.querySelector(".product-price").textContent.trim();                const price = parseFloat(priceText.replace(/[^\d.]/g, ''));                const quantityInput = productCard.querySelector(".quantity-input");                const quantity = parseInt(quantityInput.value);                                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ –º–∞—Å—Å–∏–≤                selectedProducts.push({                    id,                    name,                    price,                    quantity                });            }        });    }    if(objectType === "supplier_requests"){        updatePaymentFields();    }    if (objectType === "refunds"){        //initializeRefundTypeSelector();    }    // –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–± placeholder-—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –ø—Ä–∏–ø–æ–¥–Ω—è—Ç—ã–º–∏ –µ—Å–ª–∏ –≤ input, textarea –≤–≤–µ–¥–µ–Ω —Ç–µ–∫—Å—Ç    document.querySelectorAll('input, textarea').forEach((field) => {        const toggle = () => {            field.parentElement.classList.toggle('has-value', field.value.trim() !== '');        };        // –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ        field.addEventListener('input', toggle);        // –ø—Ä–∏ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–ª–∏ –Ω–∞—á–∞–ª—å–Ω–æ–º value        toggle();    });}function initializeRefundTypeSelector(){        const refundOptions = document.querySelectorAll('.refund-options .refund-option');        let selectedValue = ''; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è        refundOptions.forEach(option => {            option.addEventListener('click', () => {                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å active –∏ –∞—Ç—Ä–∏–±—É—Ç name —É –≤—Å–µ—Ö –æ–ø—Ü–∏–π                refundOptions.forEach(opt => {                    opt.classList.remove('active');                    opt.removeAttribute('name');                });                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å active –∏ –∞—Ç—Ä–∏–±—É—Ç name —Ç–µ–∫—É—â–µ–π –æ–ø—Ü–∏–∏                option.classList.add('active');                option.setAttribute('name', 'refund_type');                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                selectedValue = option.getAttribute('data-value');                console.log('Selected refund type:', selectedValue); // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏            });        });        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –ø–µ—Ä–µ–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º—É:        // –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ input –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ:        // const hiddenInput = document.createElement('input');        // hiddenInput.type = 'hidden';        // hiddenInput.name = 'refund_type';        // document.querySelector('.form-group').appendChild(hiddenInput);        //        // refundOptions.forEach(option => {        //     option.addEventListener('click', () => {        //         hiddenInput.value = option.getAttribute('data-value');        //     });        // });}let currentProductsPage = 1;const cardsPerPage = 5;let totalProducts = 0;let selectedProducts = [];window.showProductSelectModal = async () =>{    document.getElementById("modalProductSelect").style.display = 'flex';    document.querySelector("#modalProductSelect .modal").style.display = 'flex';    updateProductListForSelectModal();    attachProductSelectListeners();}async function updateProductListForSelectModal(){    // this.showLoading(true);    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–± –∏ –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é    const activeTab = document.querySelector(".category-tab.active");    const categoryId = activeTab?.dataset.category || null;    // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞    const searchInput = document.querySelector(".product-search-bar input");    const search = searchInput?.value || "";    try {        const response = await window.queries.searchProductsQuery(            categoryId,            search,            (currentProductsPage - 1) * cardsPerPage,            cardsPerPage        );        totalProducts = response.total_num || 0; ///    var productCards = response.list.map(product => {        		var selected = null;        var quantity =  0;        let imagesHtml = '';        if (product.images && product.images.length > 0) {            imagesHtml = product.images.map(image => {                // –ò—Å–ø–æ–ª—å–∑—É–µ–º preview –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ full                const imageUrl = image.preview || image.full || '';                return imageUrl ? `<img class="img-product-order" src="${imageUrl}" />` : '';            }).join('');        }        const rawImages = product.images;        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –º–∞—Å—Å–∏–≤        const imagesArray = Array.isArray(rawImages)            ? rawImages            : typeof rawImages === 'object' && rawImages !== null                ? Object.values(rawImages)                : [];        const imageUrls = imagesArray.map(el => (el.preview || el.full || '')).join(';');        return `                <div class="product-card ${quantity > 0 ? 'selected' : ''}" data-id="${product.id}">                    					<div class="product-image">                         ${imagesHtml}                    </div> 					                    <div class="product-info">                        <div class="product-name">${product.name}</div>                          </div>                    					                    <div class="product-card-right-container">                        <div class="product-card-right-container-block">                            <div class="product-price">${product.price.toLocaleString()}&nbsp;–≥—Ä–Ω</div>                                              <div class="product-actions">                        ${quantity > 0 ? `                                                        <div class="quantity-control active">                                <button type="button" class="quantity-btn" onclick="changeQuantity(${product.id}, -1)"                                        title="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">‚àí</button>                                <input type="hidden" name='products[${product.id}][product_id]' value="${product.id}" />   								<input type="hidden" name='products[${product.id}][price]' value="${product.price}" />                                  <input type="number" class="quantity-input" name='products[${product.id}][quantity]' value="${quantity}" min="0" max="${product.stock}"                                       onchange="setQuantity(${product.id}, this.value)"                                       onclick="this.select()">                                <button type="button" class="quantity-btn" onclick="changeQuantity(${product.id}, 1)"                                        title="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">+</button>                            </div>                        ` : `                            <button class="btn btn-primary add-product-btn"                                                   data-product-id="${product.id}"                                     title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑"                                    onclick="selectProductFromPopup(${product.id}, '${product.price}', '${product.name}', '${imageUrls}')">                                <span class="btn-icon">+</span>                                <span class="btn-text">–î–æ–±–∞–≤–∏—Ç—å</span>                            </button>                        `}                        </div>                             </div>						                        <div class="product-details">–í –Ω–∞–ª–∏—á–∏–∏:<br>${product.stock}</div> 						                    </div>					                </div>            `;    }).join('');        document.getElementById('productGrid').innerHTML =            productCards || '<div class="product-not-found">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';        renderPagination(); ///    } finally {        // this.showLoading(false);    }}function attachProductSelectListeners(){    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏    document.querySelectorAll('.category-tabs .category-tab').forEach(tab => {        tab.addEventListener('click', () => {            document.querySelectorAll('.category-tabs .category-tab')                .forEach(t => t.classList.remove('active'));            tab.classList.add('active');            updateProductListForSelectModal();        });    });    // –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞    document.querySelector('.product-search-bar .search-btn').addEventListener('click', () => {        updateProductListForSelectModal();    });    // —Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ –∏ –∫–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏    const input = document.querySelector('.product-search-bar input');    const clearBtn = document.querySelector('.product-search-bar .clear-btn');    if (!input || !clearBtn) return;    // –ü—Ä–∏ –≤–≤–æ–¥–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—á–∏—Å—Ç–∫–∏    input.addEventListener("input", () => {        clearBtn.style.display = input.value ? "block" : "none";    });    // –ö–Ω–æ–ø–∫–∞ —Å—Ç–µ—Ä–µ—Ç—å    clearBtn.addEventListener("click", () => {        input.value = "";        clearBtn.style.display = "none";        input.focus();        updateProductListForSelectModal();    });    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è    const paginationContainer = document.getElementById("order-products-pagination");    if (!paginationContainer) return;    const prevBtn = paginationContainer.querySelector(".prev-arrow");    const nextBtn = paginationContainer.querySelector(".next-arrow");    prevBtn.addEventListener("click", async () => {        if (currentProductsPage > 1) {            currentProductsPage--;            await updateProductListForSelectModal();        }    });    nextBtn.addEventListener("click", async () => {        const totalPages = Math.ceil(totalProducts / cardsPerPage);        if (currentProductsPage < totalPages) {            currentProductsPage++;            await updateProductListForSelectModal();        }    });}function renderPagination() {    const paginationContainer = document.getElementById("order-products-pagination");    if (!paginationContainer) return;    const prevBtn = paginationContainer.querySelector(".prev-arrow");    const nextBtn = paginationContainer.querySelector(".next-arrow");    const pageIndicator = paginationContainer.querySelector(".page-indicator");    const totalPages = Math.ceil(totalProducts / cardsPerPage);    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç    pageIndicator.innerHTML = `—Å—Ç—Ä ${currentProductsPage}&nbsp;–∏–∑ ${totalPages}`;    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏    prevBtn.disabled = currentProductsPage <= 1;    nextBtn.disabled = currentProductsPage >= totalPages;}window.closeProductSelectModal = async () => {    document.getElementById("modalProductSelect").style.display = 'none';    document.querySelector("#modalProductSelect .modal").style.display = 'none';}//function selectProductFromPopup(id, price, name, imagesStr) {    const images = imagesStr.split(';');    console.log(images);    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ DOM –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ø–∞–ø–∞ –∑–∞–∫–∞–∑–∞    const container = document.querySelector('.products-table tbody'); // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä    console.log(container);    if (!container) return;			var products_rows_num = 1+document.querySelectorAll('.products-table tbody tr').length;        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –º–∞—Å—Å–∏–≤    selectedProducts.push({        id,        name,        price: parseFloat(price),        quantity: 1 // –Ω–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ    });    // before max="${product.stock}" now max="1"    let newRow;    if(currentModalType === "supplier_requests"){        newRow =  `		<tr id="product-row-${id}">			<td>							<div class="product-card" style="margin-bottom: 10px;" data-id="${id}">										<input type="hidden" name='products[${products_rows_num}][product_id]' value="${id}" />  										<div class="product-image">						<img class="img-product-order" src="${images?.[0]}" />					</div>										<div class="product-info">						<div class="product-name">${name}</div>					</div>										<div class="product-card-right-container">						<div class="product-card-right-container-block">													<div style="margin-right: 10px;">                                <label class="product-label" style="display: block;">–¶–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏:</label>                                <input type="number" class="js-product-price form-input product-price" name='products[${products_rows_num}][price]' value="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É"                                onchange="updatePaymentFields()"/>                            </div>                                                    													<div class="product-actions">																		<div class="quantity-control active">										<button type="button" class="quantity-btn" onclick="changeQuantity(${id}, -1)"												title="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">‚àí</button>																				<input type="number" name='products[${products_rows_num}][quantity]' class="quantity-input" value="${1}" min="0" max="100"											   onchange="setQuantity(${id}, this.value)">										<button type="button" class="quantity-btn" onclick="changeQuantity(${id}, 1)"												title="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">+</button>									</div>																</div>						</div>						                        <div class="product-details"></div> 											</div>									</div>			</td>			        </tr>    `;    }else{        newRow = `		<tr id="product-row-${id}">			<td>							<div class="product-card" style="margin-bottom: 10px;" data-id="${id}">										<input type="hidden" name='products[${products_rows_num}][product_id]' value="${id}" />  					<input type="hidden" name='products[${products_rows_num}][price]' value="${price}" />  										<div class="product-image">						<img class="img-product-order" src="${images?.[0]}" />					</div>										<div class="product-info">						<div class="product-name">${name}</div>					</div>										<div class="product-card-right-container">						<div class="product-card-right-container-block">							<div class="product-price"> ${price} &nbsp;uah</div>							<div class="product-actions">																		<div class="quantity-control active">										<button type="button" class="quantity-btn" onclick="changeQuantity(${id}, -1)"												title="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">‚àí</button>																				<input type="number" name='products[${products_rows_num}][quantity]' class="quantity-input" value="${1}" min="0" max="100"											   onchange="setQuantity(${id}, this.value)">										<button type="button" class="quantity-btn" onclick="changeQuantity(${id}, 1)"												title="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">+</button>									</div>																</div>						</div>						                        <div class="product-details"></div> 											</div>									</div>			</td>			<td>				<div class="checkbox-group">                    <input name="orders_from_supplier[${products_rows_num}][product_id]" id="order_from_supplier" type="checkbox" value="${id}" class="checkbox-new" />                    <label for="order_from_supplier" style="font-size: 12px; color: #059669;"> –ó–∞–∫–∞–∑–∞—Ç—å —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</label>                     				</div>				<input name="orders_from_supplier[${products_rows_num}][note]" type="text" class="form-input" value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" style="width: 175px;" />			</td>			        </tr>    `;    }    const row = newRow;    container.insertAdjacentHTML('beforeend',row);    window.closeProductSelectModal();    updatePaymentFields();}//// –ü–æ–¥—Å—á–µ—Ç –æ–ø–ª–∞—Ç—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–µ–πfunction calculateFullTotal() {    const baseTotal = selectedProducts.reduce(        (sum, p) => sum + p.price * p.quantity,        0    );    const serviceFields = [        'serv_dismantling',        'serv_assembly',        'serv_packaging',        'serv_lifting',        'serv_delivery'    ];    const serviceTotal = serviceFields.reduce((sum, name) => {        const input = document.querySelector(`input[name="${name}"]`);        const value = parseFloat(input?.value) || 0;        return sum + value;    }, 0);    return baseTotal + serviceTotal;}function calculateFullTotalForSupplier(){    let baseTotal = 0;    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ü–µ–Ω–æ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º    const priceInputs = document.querySelectorAll('input.js-product-price');    priceInputs.forEach((priceInput) => {        // –ù–∞–π—Ç–∏ —Å–æ—Å–µ–¥–Ω–∏–π –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π input –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞        const rowElement = priceInput.closest('.product-card-right-container-block');        const quantityInput = rowElement?.querySelector('.quantity-input');        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞        const priceValue = parseFloat(priceInput.value) || 0;        const quantityValue = parseInt(quantityInput?.value) || 1; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ        // –£–º–Ω–æ–∂–∞–µ–º —Ü–µ–Ω—É –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ        baseTotal += priceValue * quantityValue;    });    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É    return baseTotal;}function updatePaymentFields() {    if(currentModalType === "supplier_requests"){        // –ò—â–µ–º <label> –≤–º–µ—Å—Ç–æ <input> –¥–ª—è supplier_requests        let totalInput = document.querySelector('label[name="total_amount_income"]');        if (!totalInput) return;        const total = Number(calculateFullTotalForSupplier()) || 0;        totalInput.textContent = total.toFixed(2)+" uah";    }else{        const prepayInput = document.querySelector('input[name="prepay"]');        const postpayInput = document.querySelector('input[name="postpay"]');        const discountInput = document.querySelector('input[name="discount"]');        const totalDebt = document.querySelector('input[name="total_amount_debt"]');                let totalInput = document.querySelector('input[name="total_amount_income"]');        if (!prepayInput || !postpayInput || !totalInput || !totalDebt) return;        const total = Number(calculateFullTotal()) || 0;        let prepay = parseFloat(prepayInput.value) || 0;        let postpay = parseFloat(postpayInput.value) || 0;//Math.max(0, total - prepay);        let discount = parseFloat(discountInput.value) || 0;        let debt = parseFloat(total-(prepay+postpay+discount)) || 0;//–¥–æ–ª–≥ –∫–ª–∏–µ–Ω—Ç–∞        totalInput.value = total.toFixed(2);        totalDebt.value = debt.toFixed(2);    }}////function selectProduct(product) {    addProductToOrder(product);    modalManager.switchTo('modal-order');}function attachListenersForOrderModal(){    const prepayInput = document.querySelector('input[name="prepay"]');    const postpayInput = document.querySelector('input[name="postpay"]');    const discountInput = document.querySelector('input[name="discount"]');    const serviceFields = [        'serv_dismantling',        'serv_assembly',        'serv_packaging',        'serv_lifting',        'serv_delivery'    ];    if (prepayInput) {        prepayInput.addEventListener('input', updatePaymentFields);    }    if(postpayInput){        postpayInput.addEventListener('input', updatePaymentFields);    }    if(discountInput){        discountInput.addEventListener('input', updatePaymentFields);    }    serviceFields.forEach(name => {        const input = document.querySelector(`input[name="${name}"]`);        if (input) {            input.addEventListener('input', updatePaymentFields);        }    });    // –ó–∞–ø—Ä–µ—Ç –≤–≤–æ–¥–∏—Ç—å –±—É–∫–≤—ã –≤ –∏–Ω–ø—É—Ç—ã —Å —Ç–∏–ø–æ–º number    document.querySelectorAll('input[type="number"]').forEach(input => {        input.addEventListener('keydown', function (e) {            // –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏:            const allowedKeys = [                'Backspace', 'ArrowLeft', 'ArrowRight', 'Delete', 'Tab',                'Home', 'End'            ];            const isNumber = /^[0-9]$/.test(e.key);            const isAllowed = allowedKeys.includes(e.key);            if (!isNumber && !isAllowed) {                e.preventDefault();            }        });    });    // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏    const deliveryOptions = document.querySelectorAll('.delivery-options .delivery-option');    deliveryOptions.forEach(option => {        option.addEventListener('click', () => {            // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ delivery-options            deliveryOptions.forEach(opt => opt.classList.remove('active'));            // –î–æ–±–∞–≤–ª—è–µ–º active –Ω–∞ —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç            option.classList.add('active');        });    });}function changeQuantity(id, delta) {    console.log("changeQuantity ", id, delta);    const productId = String(id);    const countInput = document.querySelector(`input[name="product-quantity-${id}"]`);    const nextValue = delta + Number(countInput.value || "0");    if(nextValue <= 0){        document.querySelector(`#product-row-${id}`)?.remove();;    }else{        countInput.value = nextValue;    }    selectedProducts = selectedProducts.map(product =>{    if(product.id === id){        return {...product, quantity: nextValue}    }    return product;    });    updatePaymentFields();}function setQuantity(id, quantity) {    if(!Number(quantity) && quantity!="0" ){        return;    }    if(quantity <= 0){        document.querySelector(`#product-row-${id}`)?.remove();;    }    selectedProducts = selectedProducts.map(product =>{        if(product.id === id){            return {...product, quantity: Number(quantity)}        }        return product;    });    updatePaymentFields();}function closeUniversalModal() {    document.querySelector('#modalContainer').innerHTML = '';    document.querySelector('#modalContainer').style.display = 'none';}window.universalHandleObjectDelete = async (objectType, objectId) => {    const formData = new FormData();    formData.append('action', 'delete');    formData.append('item_id', objectId);    const response = await fetch('/ajax/' + objectType + '/', {        method: 'POST',        body: formData,    });    if (!response.ok) {        throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª–∏–µ–Ω—Ç–∞');    }    window.closeUniversalModal();}// window.universalHandleObjectCreateOrUpdate = async (objectType, objectId) => {////     const is_new = (objectId == 0 || objectId == null);////     const modal = document.getElementById(is_new ? "modalAddTop" : "modalEditTop");////     // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ////     const formData = new FormData();////     formData.append('action', (is_new ? 'add' : 'edit'));////     if(!is_new){//         formData.append('item_id', objectId);//     }////     if(objectType === "clients") {//         formData.append('name', modal.querySelector('[name="client_name"]').value);//         formData.append('phone', modal.querySelector('[name="phone_number"]').value);//         formData.append('email', modal.querySelector('[name="email"]').value);//         formData.append('comment', modal.querySelector('[name="comment"]').value);//     }//     else if(objectType === "warehouses"){//         formData.append('name', modal.querySelector('[name="warehouse_name"]').value);//         formData.append('phone', modal.querySelector('[name="phone_number"]').value);//         formData.append('addressFull', modal.querySelector('[name="addressFull"]').value);//         formData.append('team_users_ids', modal.querySelector('[name="team_users_ids"]').value);//     }//     else if(objectType === "categories"){//         formData.append('parent_id', modal.querySelector('[name="parent_id"]').value);//         formData.append('name', modal.querySelector('[name="name"]').value);//         formData.append('attributes_ids', modal.querySelector('[name="attributes_ids"]').value);//         formData.append('in_export', modal.querySelector('[name="in_export"]').value);//     }////     const response = await fetch('/ajax/' + objectType + '/', {//         method: 'POST',//         body: formData,//     });////     if (!response.ok) {//         throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª–∏–µ–Ω—Ç–∞');//     }////     const data = await response.json(); // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON////     console.log(response);//     window.closeUniversalModal();//// }window.universalHandleObjectCreateOrUpdate = async (objectType, objectId) => {    const is_new = (objectId == 0 || objectId == null);    const modal = document.getElementById(is_new ? "modalAddTop" : "modalEditTop");    // –ù–∞–π–¥—ë–º —Ñ–æ—Ä–º—É –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞    const form = modal.querySelector('form');    console.log(form);    // –°–æ–∑–¥–∞—ë–º FormData –∏–∑ –≤—Å–µ–π —Ñ–æ—Ä–º—ã —Å—Ä–∞–∑—É    const formData = new FormData(form);    console.log(formData);    // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è    formData.set('action', is_new ? 'add' : 'edit');    if (!is_new) {        formData.set('item_id', objectId);    }    try {    const response = await fetch('/ajax/' + objectType + '/', {        method: 'POST',        body: formData,    });    if (!response.ok) {        throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');    }    const result = await response.json();    console.log(response);    if (!response.ok || result.status === 'error') {        this.showNotification(result.error);        return;    }    window.closeUniversalModal();    } catch (error) {        console.error("–û—à–∏–±–∫–∞:", error);        this.showNotification(error.message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");    }};// –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ø–∏–∏ —Ç–æ–≤–∞—Ä–∞window.assignModalIdAndCopy  = async (button) => {    const modal = button.closest('.modal');    if (!modal) return;    const originalId = modal.id;    // –í—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º id, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç universalHandleObjectCreateOrUpdate    modal.id = "modalAddTop";    // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥    window.universalHandleObjectCreateOrUpdate('catalog', 0);    // –ß–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π id    setTimeout(() => {        modal.id = originalId;    }, 1000); // –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 1 —Å–µ–∫—É–Ω–¥—ã, –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ}//function viewOrder(orderId) {    fetch('/ajax/orders/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: 'action=get_order&id=' + encodeURIComponent(orderId)    })    .then(response => response.text())    .then(html => {        document.getElementById('modalContainer').innerHTML = html;        document.getElementById('currentOrderModal').style.display = 'block';    })    .catch(console.error);}function getShiftsOrders() {}function registerOrderPaymentInShift(orderId, amount, comment = '') {    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: new URLSearchParams({            action: 'add_cash_from_order',            order_id: orderId,            amount: amount,            comment: comment        })    })    .then(r => r.json())    .then(json => {        if (json.saved) {            console.log('–ö–∞—Å—Å–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞');        } else {            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ —Å–º–µ–Ω–µ');        }    })    .catch(console.error);}function saveOrder(orderData) {    fetch('/ajax/shifts/', {        method: 'POST',        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },        body: 'action=get_current_shift_id'    })    .then(r => r.json())    .then(json => {        if (!json.shift_id) {            alert("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã!");            return;        }        orderData.shift_id = json.shift_id;        fetch('/ajax/orders/', {            method: 'POST',            headers: { 'Content-Type': 'application/json' },            body: JSON.stringify({                action: 'create_order',                data: orderData            })        })        .then(r => r.json())        .then(response => {            if (response.success) {                registerOrderPaymentInShift(response.order_id, orderData.total_sum);                closeNewOrderModal();            } else {                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');            }        });    });}function loadCurrentShiftOrders() {    let warehouse_select = document.querySelector("#select-warehouse");    let warehouse_id = 'all';    if(warehouse_select){        //–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–∞–ª–æ–Ω–∞        warehouse_select.addEventListener('change', function(e){            loadCurrentShiftOrders();        });        warehouse_id = warehouse_select.value;    }    fetch('/ajax/shifts/', {        method: 'POST',        headers: {'Content-Type': 'application/x-www-form-urlencoded'},        body: 'action=get_orders_for_current_shift&warehouse_id='+warehouse_id    })    .then(r => r.json())    .then(data => {        const tbody = document.querySelector('#current_shift_orders_table tbody');        tbody.innerHTML = ''; // –æ—á–∏—Å—Ç–∫–∞        if (!data.list || !data.list.length) {            tbody.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';            return;        }        const title = document.querySelector('#current_shift_orders_count');        title.innerHTML =  `–¢–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã —Å–º–µ–Ω—ã (`+data.total_num+`)`;         data.list.forEach(order => {            			const row = document.createElement('tr');            			row.innerHTML = `            <tr>                <td><strong>#${order.id}</strong>  |  ${order.created_at}</td>                <td>${order.client.name}<br><small>${order.client_info}</small></td>                <td>                    ${order.products?.map(product => product.name).join(", ")}					<br/>					<div class="photos-preview">						${order.products?.map(product => {														if (!product.images || product.images.length === 0) {return '';}														return product.images.map(image => {								// –ò—Å–ø–æ–ª—å–∑—É–µ–º preview –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ full								const imageUrl = image.preview || image.full || '';								return imageUrl ? `<img src="${imageUrl}" />` : '';							}).join('');													}).join("")}					</div>                </td>                <td>${order.prepay}&nbsp;uah</td>                <td>${order.postpay}&nbsp;uah</td>                <td class="comment-cell">${order.comment}</td>                <td class="total-status-cell">                    <div class="total-status-wrapper">                        <strong>${order.total}&nbsp;uah</strong>                        <span class="badge badge-success">${order.status}</span>                    </div>                </td>                `+(order.shift ? ("<td>"+order.shift.warehouse_name+"</td>") : "")+`                <td class="actions-cell">                    <div class="actions-wrapper">                    						<button class="btn btn-icon btn-secondary" onclick="window.showUniversalModal('orders',${order.id})" 						 ${order.isEditable ? `title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è`: `title="–ü—Ä–æ—Å–º–æ—Ç—Ä">üëÅÔ∏è`}                        </button>						                        <button class="btn btn-icon btn-secondary" onclick="" title="–ü–µ—á–∞—Ç—å">üì†</button>						                    </div>                </td>            </tr>`;			            tbody.appendChild(row);			        });    });}window.loadCurrentShiftOrders = loadCurrentShiftOrders;document.addEventListener('DOMContentLoaded', () => {    if (window.location.pathname === '/' || window.location.pathname === '/index.php') {        loadCurrentShiftOrders();    }});// –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–æ–Ω –ø–æ Escapefunction closeCashInModal() {    const modal = document.querySelector('#cash-in-modal');    if (modal) {        modal.classList.remove('modal--visible');    }}function closeCashOutModal() {    const modal = document.querySelector('#cash-out-modal');    if (modal) {        modal.classList.remove('modal--visible');    }}document.addEventListener('keydown', function (e) {    if (e.key === 'Escape') {        closeShiftModal();    }});function showNotification(message, type = 'error'){    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    document.querySelectorAll('.notification').forEach(n => n.remove());    const notification = document.createElement('div');    notification.className = `notification notification-${type}`;    const icons = {        success: '‚úì',        error: '‚ö†',        info: '‚Ñπ',        warning: '‚ö°'    };    notification.innerHTML = `            <div class="notification-content notification-card-${type}">                <span class="notification-icon">${icons[type] || icons.info}</span>                <span class="notification-message">${message}</span>                <button class="notification-close modal-close" onclick="this.parentElement.parentElement.remove()">√ó</button>            </div>        `;    document.body.appendChild(notification);    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è    requestAnimationFrame(() => {        notification.classList.add('show');    });    // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ    setTimeout(() => {        notification.classList.add('hide');        setTimeout(() => notification.remove(), 300);    }, 4000);} 